<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BSRef - Databases</title>
    <link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,200;0,300;0,400;0,700;1,200;1,300;1,400;1,700&display=swap"
      rel="stylesheet" />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap"
      rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script src="../scripts/format-html.js" async></script>
    <link href="../styles/global.css" type="text/css" rel="stylesheet" />
  </head>
  <body>
    <header class="header">
      <nav class="nav">
        <a href="../" class="nav__button anchor--nostyle">
          <h2 class="nav__heading">BSRef</h2>
        </a>
      </nav>
    </header>
    <main class="main">
      <h1 class="main__heading">Databases</h1>
      <p class="main__description">
        Databases provide programs and computers a method of storing data at large scales, and reading or writing that
        data at high speeds in a modular, efficient way.
      </p>
      <ul class="notes">
        <li class="note">
          Data is stored as 1s and 0s, and the way we're used to interfacing with data is through files. Files are
          largely designed to be interactable and readable by humans, but databases are really only concerned with
          storing data in a machine-readable way.
        </li>
        <li class="note">
          The most popular databases are either relational or non-relational, with MySQL being the most popular
          relational database, and MongoDB being the most popular non-relational database.
        </li>
        <li class="note">
          Databases are very "close to the metal," meaning they aren't spreadsheets or files in any traditional sense.
          Instead, data is often stored in "tables," which are collections of items and attributes that have some
          relationship.
        </li>
        <li class="note">
          Each table has rows and columns, with each row often representing a <strong>record</strong>. Columns would
          represent individual pieces of data about those records, and are often called <strong>fields</strong>.
        </li>
        <li class="note">
          A database can have multiple tables, with multiple types or categories of record. These can then be associated
          with one another in a variety of ways, which is where databases begin to really show their power.
        </li>
        <li class="note">In a database, everything has to have a unique ID. This is called a <strong>key</strong>.</li>
        <li class="note">
          Each table needs a field that holds a <strong>primary key</strong> - the unique identifier for that record. A
          <strong>foreign key</strong> would point to a relational record in a different database.
        </li>
        <li class="note">
          There are a few types of <strong>relationships</strong> in a relational database:
          <strong>one-to-one (1:1)</strong> and <strong>one-to-many (1:N)</strong> are two of the most common.
          One-to-one would mean that each record relates to exactly one foreign record, while one-to-many would
          represent a single record that has a relationship with many of a different type of record.
        </li>
        <li class="note">
          A <strong>many-to-many (M:N)</strong> relationship is also possible, where in both directions, records can
          have a relationship with many other records. Typically, when there is a many-to-many relationship, there is
          often a third table involved - sometimes called a "join" table - which will have an entry for each joined bit
          of data.
        </li>
        <li class="note">
          <strong>SQL</strong> stands for <strong>Structured Query Language</strong> - it is a language that allows for
          <strong>queries</strong>, which pull data out of our tables quickly and efficiently.
        </li>
        <li class="note">
          A <strong>Database Management System (DBMS)</strong> provides a method for manipulating and logging and
          interacting with data, like MySQL. A <strong>database (DB)</strong> isn't the thing we would normally work
          with - instead, we would work with a DBMS to handle database interactions.
        </li>
      </ul>
      <h2 class="main__subheading">MySQL</h2>
      <ul class="notes">
        <li class="note">
          See
          <a href="https://www.mysqltutorial.org/mysql-cheat-sheet.aspx" target="_blank" target="_blank"
            >this website</a
          >
          for a useful cheat sheet for MySQL basics.
        </li>
        <li class="note">
          The MySQL node package that allows usu to interact with MySQL using Node is called
          <a href="https://www.npmjs.com/package/mysql2" target="_blank">mysql2</a>.
        </li>
        <li class="note">
          <code>mysql</code> is a command line tool that lets us interact with MySQL databases from the command line.
        </li>
        <li class="note">To create a new database, we can use <code>CREATE DATABASE new_database_name;</code>.</li>
        <li class="note">To show the existing databases, we can use <code>SHOW DATABASES;</code>.</li>
        <li class="note">To pick a database to use, we can use <code>USE new_database_name;</code>.</li>
        <li class="note">
          Once we're in our database, we can interact with it in a number of ways. For example, to create a new table,
          we could write something like this:
          <pre><code>CREATE TABLE `tablename` (
  `id` int unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(255) NOT NULL,
  PRIMARY KEY (`id`)
);</code></pre>
        </li>
        <li class="note">To view our existing tables, we can use <code>SHOW TABLES;</code>.</li>
        <li class="note">
          To alter an existing table, we use <code>ALTER TABLE tablename</code> followed by the alteration we want.
        </li>
        <li class="note">
          To add a new column, for example, we would use
          <pre><code>ALTER TABLE tablename
  ADD COLUMN last_updated timestamp NULL DEFAULT CURRENT_TIMESTAMP;</code></pre>
        </li>
        <li class="note">
          To add a record to a table, we can use INSERT like so:
          <code>INSERT INTO tablename(name) VALUES('Record Number 1');</code>
        </li>
        <li class="note">
          To access, or "select" a file, from a table, we can use SELECT-FROM-WHERE. For example:
          <pre><code>SELECT name, last_updated FROM tablename WHERE id = 1;</code></pre>
        </li>
        <li class="note">
          To update a record, we can use UPDATE-SET-WHERE. For example:
          <pre><code>UPDATE tablename SET name = "Awesome Record 1" WHERE id = "1";</code></pre>
        </li>
        <li class="note">To delete data, we can use DELETE-FROM-WHERE in the same format as SELECT-FROM-WHERE.</li>
        <li class="note">See the cheat sheet above foro many more useful CLI commands and MySQL query examples.</li>
      </ul>
      <h2 class="main__subheading">Joins</h2>
      <ul class="notes">
        <li class="note">
          If we want to get information from two different records, we can use <strong>joins</strong>. For example, if
          we had another table called users with a FOREIGN_KEY referencing "tablename", we could get both "tablename"
          names and "user" names like so:
          <pre><code>SELECT tablename.name, user.name 
  FROM tablename
  INNER JOIN users
  ON tablename.id = users.table_id;</code></pre>
        </li>
      </ul>
      <h2 class="main__subheading">MySQL Workbench</h2>
      <ul class="notes">
        <li class="note">
          See
          <a href="https://dev.mysql.com/doc/workbench/en/wb-eer-diagrams-section.html" target="_blank"
            >this page on MySQL's website</a
          >
          to learn more about <strong>EER (Enhanced Entity-Relationship) Diagrams</strong> and how to view/create them
          in MySQL Workbench.
        </li>
      </ul>
      <h2 class="main__subheading">Knex.js</h2>
      <ul class="notes">
        <li class="note">
          Knex.js is an SQL schema & query builder that supports asynchronous querying of a database in Node.
        </li>
        <li class="note">
          It supports both JS-only syntax for writing queries and raw SQL if necessary, and works with basically any SQL
          database, like MySQL, SQLite, etc.
        </li>
        <li class="note">
          To install <a href="https://knexjs.org/" target="_blank">the knex.js</a> package, we can run
          <code>npm i knex</code>. To create a "knexfile", which is a configuration file for knex, we can run
          <code>npx knex init</code>.
        </li>
        <li class="note">
          We can configure our knexfile to initialize a database connection.
          <a href="https://knexjs.org/guide/#configuration-options" target="_blank">Check here for config options</a>.
        </li>
      </ul>
      <h2 class="main__subheading">Migrations in Knex</h2>
      <ul class="notes">
        <li class="note">
          To interact with databases in a non-destructive way that won't hurt the production database.
          <strong>Migrations</strong> facilitate this.
        </li>
        <li class="note">
          We can create a migrations folder with <code>npx knex migrate:make migration_file_name</code>. This allows us
          to create "up" and "down" functions to define how to create and drop tables in real time when our server is
          run, allowing for testing.
        </li>
        <li class="note">
          When a new migration file is automatically created, it will have placeholders for our up and down functions.
          This is where we can define what changes will be made when we run the migration.
        </li>
        <li class="note">
          <code>npx knex migrate:latest</code> to apply any not-yet-executed migrations. To undo the latest migration(s)
          applied, use <code>npx knex migrate:latest</code>.
        </li>
        <li class="note">
          <code>npx knex migrate:up</code> will run all migrations, up to the latest version.
          <code>npx knex migrate:down</code> will rollback all migrations back to the starting point.
        </li>
        <li class="note">
          <code>npx knex migrate:status</code> will display the current status of all migrations, including which are
          pending and which have been applied.
        </li>
        <li class="note">
          Inside our migration file, we can use commands like <code>knex.schema.createTable()</code> to define a new
          table to "mount"/create in our database. See all available schema commands
          <a href="https://knexjs.org/guide/schema-builder.html#essentials" target="_blank">here</a>, or all chainable
          schema building methods
          <a href="https://knexjs.org/guide/schema-builder.html#chainable-methods" target="_blank">here</a>.
        </li>
      </ul>
      <h2 class="main__subheading">Seeding data in Knex</h2>
      <ul class="notes">
        <li class="note">
          To populate a table with data, we need to <strong>seed</strong> our data. In order to create a new seed file,
          we can run <code>npx knex seed:make populate_table_name</code>. This will create a "seeds" folder that allows
          us to define a new seed to run when a table is created/made live.
        </li>
        <li class="note">
          Often, in a seed function, the first thing we'll do is clear all entries out of a table. For example:
          <code>await knex('table_name').del()</code>. Then, we would typically populate what we want with something
          like:
          <pre><code>await knex('table_name').insert([
  { name: "New Entry in Table" },
]);</code></pre>
        </li>
        <li class="note">To run our seeds, we can use <code>knex seed:run</code>.</li>
      </ul>
    </main>
  </body>
</html>
